<div class="app-shell">
  <!-- Header: centered logo -->
  <header class="container-fluid px-0">
    <div class="screen-pad app-header mb-1">
      <img
        src="assets/nc-logo.png"
        alt="Natural Cycles"
        class="nc-logo"
        height="22"
        decoding="async"
      />
    </div>
  </header>

  <main class="app-main mt-3">
    <section class="stage container-fluid mt-5 px-0">
      <div class="stage-inner screen-pad pt-0">
        <!-- Title -->
        <span
          class="fit-line event-line d-block mb-2"
          appTextFit
          #titleFit="textFit"
          [minPx]="16"
          [maxPx]="900"
          [paddingPx]="16"
          [onlyOnResize]="true"
        >
          {{ 'Time to ' + settingsSnapshot().eventName }}
        </span>

        <!-- Countdown -->
        <span
          class="fit-line countdown-line d-block mt-4"
          appTextFit
          #countFit="textFit"
          [minPx]="20"
          [maxPx]="1200"
          [paddingPx]="16"
          aria-hidden="true"
        >
          {{ remainingLabel() }}
        </span>

        <!-- Warning if saved date is past -->
        <div
          *ngIf="pastWarning()"
          id="date-warn"
          class="text-danger fw-bold mt-4"
          role="status"
        >
          ⚠️ The selected date is in the past, Countdown is clamped to 0.
        </div>

        <!-- Quote under countdown -->
        <section class="quote-area container-fluid px-0 mb-4">
          <div class="mt-3 mb-3 py-3">
            <div class="quote-text small">
              <ng-container *ngIf="!quoteLoading(); else loading">
                <ng-container *ngIf="!quoteError(); else errorTpl">
                  {{ quote() }}
                </ng-container>
              </ng-container>

              <ng-template #loading>
                <span class="text-secondary">
                  <span
                    class="spinner-border spinner-border-sm me-2"
                    role="status"
                    aria-label="Loading quote"
                  ></span>
                  Loading quote...
                </span>
              </ng-template>

              <ng-template #errorTpl>
                <span class="text-warning">{{ quoteError() }}</span>
                <button
                  class="btn btn-link btn-sm p-0 align-baseline"
                  (click)="fetchQuote()"
                >
                  Retry
                </button>
              </ng-template>
            </div>
          </div>
        </section>

        <!-- Inputs -->
        <form #f="ngForm" (ngSubmit)="applySettings()">
          <div class="row gx-3 gx-md-4 gy-5 gy-md-3 justify-content-md-center">
            <!-- Title -->
            <div class="col-12 col-md-auto d-flex justify-content-center">
              <div class="nc-field">
                <label class="nc-label" for="titleInput">Title</label>
                <input
                  id="titleInput"
                  name="title"
                  class="form-control nc-input"
                  [ngModel]="formEventName()"
                  (ngModelChange)="formEventName.set($event)"
                  required
                  pattern=".*\S.*"
                />
              </div>
            </div>

            <!-- Date -->
            <div class="col-12 col-md-auto d-flex justify-content-center">
              <div class="nc-field">
                <label class="nc-label" for="dateInput">Date</label>
                <input
                  id="dateInput"
                  name="date"
                  type="date"
                  class="form-control nc-input"
                  [ngModel]="formDate()"
                  (ngModelChange)="formDate.set($event)"
                  required
                  #dateCtrl="ngModel"
                  [attr.aria-describedby]="pastWarning() ? 'date-warn' : null"
                  [attr.aria-invalid]="pastWarning() ? 'true' : null"
                />
              </div>
            </div>

            <!-- Save -->
            <div class="col-12 mt-5 mt-md-5 d-flex justify-content-center">
              <button
                type="submit"
                class="nc-cta"
                [disabled]="!formEventName() || !formDate()"
              >
                Save
              </button>
            </div>
          </div>
        </form>
      </div>
    </section>
  </main>
</div>
